<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Cloud</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --light: #f8f9fa;
            --dark: #212529;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--dark);
            color: white;
            overflow: hidden;
            height: 100vh;
        }
        
        .photo-cloud {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        
        .photo {
            position: absolute;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
            overflow: hidden;
            border: 8px groove rgba(255, 255, 255);
            transform-origin: center center; 

        }
        
        .photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        
        .count-display {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 15px;
            font-size: 0.9rem;
            z-index: 100;
        }
        
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        
   
    </style>
</head>
<body>
    <div class="photo-cloud" id="photoCloud">
        <!-- Photos will be inserted here by JavaScript -->
    </div>
    
    <div class="count-display" id="countDisplay">
        0 Fotos
    </div>
    
    
    
    <script>
        // DOM Elements
        const photoCloud = document.getElementById('photoCloud');
        const countDisplay = document.getElementById('countDisplay');
        const addBtn = document.getElementById('addBtn');
        const clearBtn = document.getElementById('clearBtn');
        
        // Configuration
        const MAX_PHOTOS = 500;
        const INITIAL_SIZE = 180;
        const MIN_SIZE = 120;
        const SCALING_THRESHOLD = 40;
        const ADD_INTERVAL = 100;
        const GAP_SIZE = 10; // Increased gap between photos
        const GRID_RESOLUTION = 150;
        
        // State
        let currentPhotos = [];
        let isSimulating = false;
        let simulationInterval = null;
        let currentSize = INITIAL_SIZE;
        let scaleFactor = 1;
        let densityGrid = [];
        
        // Initialize
        initPhotoCloud();
        
        function initPhotoCloud() {
            initializeDensityGrid();
            startSimulation();
            
            addBtn.addEventListener('click', () => {
                if (!isSimulating) startSimulation();
            });
            
            clearBtn.addEventListener('click', () => {
                stopSimulation();
                currentPhotos = [];
                photoCloud.innerHTML = '';
                countDisplay.textContent = '0 Fotos';
                currentSize = INITIAL_SIZE;
                scaleFactor = 1;
                initializeDensityGrid();
            });
        }
        
        function initializeDensityGrid() {
            densityGrid = Array(GRID_RESOLUTION).fill().map(() => 
                Array(GRID_RESOLUTION).fill(0));
        }
        
        function updateDensityGrid(x, y, size, add = true) {
            const gridSizeX = photoCloud.clientWidth / GRID_RESOLUTION;
            const gridSizeY = photoCloud.clientHeight / GRID_RESOLUTION;
            
            // Include gap in calculations
            const paddedSize = size + GAP_SIZE;
            
            const startX = Math.floor((x - GAP_SIZE/2) / gridSizeX);
            const startY = Math.floor((y - GAP_SIZE/2) / gridSizeY);
            const endX = Math.floor((x + paddedSize) / gridSizeX);
            const endY = Math.floor((y + paddedSize) / gridSizeY);
            
            for (let gy = startY; gy <= endY; gy++) {
                for (let gx = startX; gx <= endX; gx++) {
                    if (gx >= 0 && gx < GRID_RESOLUTION && gy >= 0 && gy < GRID_RESOLUTION) {
                        densityGrid[gy][gx] += add ? 1 : -1;
                    }
                }
            }
        }
        
        function findEmptyArea(size) {
            const containerWidth = photoCloud.clientWidth;
            const containerHeight = photoCloud.clientHeight;
            const gridSizeX = containerWidth / GRID_RESOLUTION;
            const gridSizeY = containerHeight / GRID_RESOLUTION;
            
            // Find the least dense grid cell
            let minDensity = Infinity;
            let bestCells = [];
            
            for (let gy = 0; gy < GRID_RESOLUTION; gy++) {
                for (let gx = 0; gx < GRID_RESOLUTION; gx++) {
                    if (densityGrid[gy][gx] < minDensity) {
                        minDensity = densityGrid[gy][gx];
                        bestCells = [{gx, gy}];
                    } else if (densityGrid[gy][gx] === minDensity) {
                        bestCells.push({gx, gy});
                    }
                }
            }
            
            // Try to place in the least dense areas first
            for (let i = 0; i < bestCells.length; i++) {
                const {gx, gy} = bestCells[i];
                
                // Calculate available area with gap
                const paddedSize = size + GAP_SIZE;
                const minX = Math.max(0, gx * gridSizeX + GAP_SIZE/2);
                const minY = Math.max(0, gy * gridSizeY + GAP_SIZE/2);
                const maxX = Math.min(containerWidth - size, (gx + 1) * gridSizeX - GAP_SIZE/2 - size);
                const maxY = Math.min(containerHeight - size, (gy + 1) * gridSizeY - GAP_SIZE/2 - size);
                
                if (maxX > minX && maxY > minY) {
                    return {
                        x: minX + Math.random() * (maxX - minX),
                        y: minY + Math.random() * (maxY - minY)
                    };
                }
            }
            
            // Fallback to random position with gaps
            return {
                x: GAP_SIZE/2 + Math.random() * (containerWidth - size - GAP_SIZE),
                y: GAP_SIZE/2 + Math.random() * (containerHeight - size - GAP_SIZE)
            };
        }
        
        function startSimulation() {
            if (isSimulating) return;
            isSimulating = true;
            
            if (currentPhotos.length >= MAX_PHOTOS) {
                currentPhotos = [];
                photoCloud.innerHTML = '';
                countDisplay.textContent = '0 Fotos';
                currentSize = INITIAL_SIZE;
                scaleFactor = 1;
                initializeDensityGrid();
            }
            
            simulationInterval = setInterval(() => {
                if (currentPhotos.length < MAX_PHOTOS) {
                    addNewPhoto(createRandomPhoto());
                } else {
                    stopSimulation();
                }
            }, ADD_INTERVAL);
        }
        
        function stopSimulation() {
            clearInterval(simulationInterval);
            isSimulating = false;
        }
        
        function addNewPhoto(photo) {
            currentPhotos.push(photo);
            
            // Calculate scaling after threshold
            if (currentPhotos.length > SCALING_THRESHOLD) {
                scaleFactor = Math.max(
                    MIN_SIZE / INITIAL_SIZE,
                    1 - (currentPhotos.length - SCALING_THRESHOLD) / (MAX_PHOTOS - SCALING_THRESHOLD) * (1 - MIN_SIZE/INITIAL_SIZE)
                );
                currentSize = INITIAL_SIZE * scaleFactor;
                
                // Scale all existing photos
                // document.querySelectorAll('.photo').forEach(photoEl => {
                //     const originalWidth = parseInt(photoEl.dataset.originalWidth || INITIAL_SIZE);
                //     const newWidth = originalWidth * scaleFactor;
                //     photoEl.style.width = `${newWidth}px`;
                //     photoEl.style.height = `${newWidth}px`;
                    
                //     // Update position after scaling
                //     const left = parseInt(photoEl.style.left);
                //     const top = parseInt(photoEl.style.top);
                //     updateDensityGrid(left, top, originalWidth, false);
                //     updateDensityGrid(left, top, newWidth, true);
                // });
            }
            
            renderPhoto(photo);
            countDisplay.textContent = `${currentPhotos.length} Fotos`;
        }
        
        function renderPhoto(photo) {
            const photoElement = document.createElement('div');
            photoElement.className = 'photo';
            photoElement.style.width = `${currentSize}px`;
            photoElement.style.height = `${currentSize}px`;
            photoElement.dataset.originalWidth = currentSize;
            
            const img = document.createElement('img');
            img.src = photo.imageUrl;
            img.alt = 'User photo';
            img.loading = 'lazy';
            
            photoElement.appendChild(img);
            photoCloud.appendChild(photoElement);
            
            // Position photo with gaps
            const position = findEmptyArea(currentSize);
            photoElement.style.left = `${position.x}px`;
            photoElement.style.top = `${position.y}px`;
            
            // Update density grid with gap
            updateDensityGrid(position.x, position.y, currentSize);
            
            // Random rotation for organic feel
            photoElement.style.transform = `rotate(${Math.random() * 10 - 5}deg)`;
        }
        
        function createRandomPhoto() {
            return {
                id: Date.now() + Math.random(),
                imageUrl: `https://picsum.photos/500/500?random=${Date.now() + Math.random()}`,
                timestamp: new Date().toISOString()
            };
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            initializeDensityGrid();
            document.querySelectorAll('.photo').forEach(photo => {
                const size = parseInt(photo.style.width);
                const position = findEmptyArea(size);
                photo.style.left = `${position.x}px`;
                photo.style.top = `${position.y}px`;
                updateDensityGrid(position.x, position.y, size);
            });
        });
    </script>
</body>
</html>