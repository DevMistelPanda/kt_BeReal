<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Image Collage</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            flex-direction: column;
            font-family: Arial, sans-serif;
        }
        canvas {
            background: white;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #loading {
            margin-bottom: 20px;
        }
        .controls {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Enhanced Image Collage</h1>
    <div id="loading">Loading images (0/10)...</div>
    <canvas id="collageCanvas"></canvas>
    <div class="controls">
        <button id="regenerate">Regenerate</button>
    </div>
    
    <script>
        const canvas = document.getElementById("collageCanvas");
        const ctx = canvas.getContext("2d");
        const loadingElement = document.getElementById("loading");
        const regenerateBtn = document.getElementById("regenerate");

        function initCanvas() {
            canvas.width = Math.min(800, window.innerWidth * 0.9);
            canvas.height = Math.min(600, window.innerHeight * 0.7);
        }
        initCanvas();

        const images = Array(10).fill().map((_, i) => 
            `https://picsum.photos/id/${Math.floor(Math.random() * 1000)}/300/200`
        );

        const imageObjects = [];
        const baseImgSize = 120;
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        let spiralSpacing = 25;
        let angleStep = Math.PI / 5;

        // Load images with progress
        images.forEach((src, index) => {
            let img = new Image();
            img.src = src;
            img.onload = () => {
                imageObjects.push(img);
                loadingElement.textContent = `Loading images (${imageObjects.length}/${images.length})...`;
                if (imageObjects.length === images.length) {
                    loadingElement.style.display = 'none';
                    drawCollage();
                }
            };
            img.onerror = () => {
                console.error('Failed to load image:', src);
                // Push a blank image or handle error
                imageObjects.push(createErrorImage());
                if (imageObjects.length === images.length) {
                    loadingElement.style.display = 'none';
                    drawCollage();
                }
            };
        });

        function createErrorImage() {
            const img = new Image();
            img.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNmZmYiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBhbGlnbm1lbnQtYmFzZWxpbmU9Im1pZGRsZSIgZmlsbD0iIzAwMCI+SW1hZ2UgRXJyb3I8L3RleHQ+PC9zdmc+';
            return img;
        }

        function drawCollage() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < imageObjects.length; i++) {
                const angle = i * angleStep;
                const radius = i * spiralSpacing;
                const sizeVariation = 40;
                const currentSize = baseImgSize + (Math.random() * sizeVariation - sizeVariation/2);
                
                let x = centerX + radius * Math.cos(angle) - currentSize / 2;
                let y = centerY + radius * Math.sin(angle) - currentSize / 2;
                
                // Draw with rotation
                ctx.save();
                ctx.translate(x + currentSize/2, y + currentSize/2);
                ctx.rotate(angle);
                ctx.drawImage(imageObjects[i], -currentSize/2, -currentSize/2, currentSize, currentSize);
                ctx.restore();
            }
        }

        // Regenerate with new parameters
        regenerateBtn.addEventListener('click', () => {
            angleStep = Math.PI / (4 + Math.random() * 4);
            spiralSpacing = 15 + Math.random() * 20;
            drawCollage();
        });

        // Make responsive
        window.addEventListener('resize', () => {
            initCanvas();
            if (imageObjects.length === images.length) {
                drawCollage();
            }
        });
    </script>
</body>
</html>